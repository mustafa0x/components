<button class="btn dropdown-btn" on:click={toggle_menu}><icon id=people></button>
<div class=dropdown-menu bind:this={menu} on:focusout={focusout} hidden>
  <slot/>
</div>

<svelte:window on:resize={() => position_menu(menu, menu.previousElementSibling)}/>

<script>
import {api_call} from '../util/util.js'
import positioner from 'positioner'

let menu

const position_menu = (el, attach_to) => { positioner(el, attach_to.getBoundingClientRect(), 'bottom') }
function focusout() {
    setTimeout(() => {
        if (menu && !menu.contains(document.activeElement))
            setTimeout(() => menu.hidden = true, 50)
    }, 150)
}

async function toggle_menu(e) {
    menu.hidden = !menu.hidden
    if (menu.hidden)
        return

    if (window._useragent.safari)
        e.target.focus()
    await tick()
    position_menu(menu, e.target)
}
</script>

<style>

/* Dropdown menus */
.dropdown-btn {
  display: flex;
  align-items: center;
  padding: 0 0.5rem 0 0.2rem;
  min-width: revert !important;
}
.dropdown-btn .icon-chevron-bottom {
  width: 17px;
}
.dropdown-menu {
  position: absolute;
  z-index: 10;
  background: #fff;
  border-radius: 0.3rem;
  font-size: 0.85rem;
  box-shadow: 0 0 5px #aaa;
  transition: top 0.1s;
  max-width: 250px;
  min-width: 5rem;
}

.dropdown-menu button {
  width: 100%;
  display: flex;
  justify-content: space-between;
  padding: 0.15rem 0.3rem;
  border-radius: 0;
  text-align: unset;
}
.dropdown-menu button:hover {
  background: #eee;
}
</style>
